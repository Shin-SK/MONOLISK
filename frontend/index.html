<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no">
    <title>MONOLISK</title>

    <meta name="theme-color" content="#111111">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="MONOLISK">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="application-name" content="MONOLISK" />
    <link rel="manifest" href="/manifest.webmanifest">
    
    <link rel="icon" href="/favicon.svg">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">

    <link rel="preload" as="style"
          href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;900&display=swap"
          onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet"
          href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;900&display=swap"></noscript>
    <!-- スピナー -->
    <link rel="preload" as="image" href="/img/logo.webp" as="image">
    <style>
      #splash{
        position:fixed; inset:0; z-index:2147483647;
        display:flex; align-items:center; justify-content:center; flex-direction:column;
        background:#f7f7f7;

        /* デフォルトは非表示（最初の1秒は出さない） */
        opacity:0; transform: translateY(8px) scale(.985); filter: blur(1.2px);
        transition:
          opacity   .60s cubic-bezier(.22,.61,.36,1),
          transform .60s cubic-bezier(.22,.61,.36,1),
          filter    .60s ease;
      }
      /* 1秒経っても終わってなければ表示 */
      #splash.visible{
        opacity:1; transform: translateY(0) scale(1); filter: blur(0);
      }
      /* 消すときはさらにふわっと */
      #splash.hide{
        opacity:0; transform: translateY(10px) scale(.98); filter: blur(1.6px);
        pointer-events:none;
      }

      #splash .logo{ width:64px; height:64px; display:block; object-fit:contain; }
      #splash .name{ margin-top:.5rem; width:80px; height:auto; }

      @keyframes spinBackish {
        0% { transform:rotate(0deg) }
        60%{ transform:rotate(380deg) }
        100%{ transform:rotate(360deg) }
      }
      #splash .logo{ animation:spinBackish 2.5s cubic-bezier(.175,.885,.32,1.275) infinite; }
      @media (prefers-reduced-motion: reduce){
        #splash, #splash.visible, #splash.hide{ transition:none }
        #splash .logo{ animation:none }
      }

      /* app のふわっと入場はそのまま */
      #app.app-hidden{ opacity:0; transform: translateY(2px); transition: opacity .36s ease, transform .36s ease; }
      #app.app-shown { opacity:1; transform:none; }
      @media (prefers-reduced-motion: reduce){
        #app.app-hidden, #app.app-shown{ transition:none }
      }

      /* 環境バッジ（URLに sandbox / staging を含む場合のみ表示） */
      .env-badge{ position:fixed; top:8px; left:8px; z-index:2147483647; padding:4px 8px; border-radius:999px; font:600 11px/1.2 system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji'; letter-spacing:.4px; opacity:0; transform:translateY(-4px); transition: opacity .24s ease, transform .24s ease; box-shadow:0 2px 10px rgba(0,0,0,.12) }
      .env-badge.show{ opacity:1; transform:none }
      .env-sandbox{ background:#EA580C; color:#fff }
      .env-staging{ background:#7C3AED; color:#fff }
    </style>
    <script>
      (function(){
        window.__splashStart = performance.now();
        const SHOW_AFTER = 2000; // 最初の1秒は出さない
        function showIfStillLoading(){
          if (window.__splashDone) return; // もう終わってたら出さない
          const el = document.getElementById('splash');
          el && el.classList.add('visible');
        }
        window.__splashShowTimer = setTimeout(showIfStillLoading, SHOW_AFTER);
      })();
    </script>
    <script>
      // URL に応じて [SANDBOX]/[STAGING] をタイトル先頭へ付与し、左上に小さなバッジを出す
      (function(){
        const href = (location.hostname + location.pathname + location.search + location.hash).toLowerCase();
        let label = '';
        if (href.includes('sandbox')) label = 'SANDBOX';
        else if (href.includes('staging')) label = 'STAGING';
        if (!label) return;

        // タイトルの先頭に [LABEL] を付与（既存の [XXX] は置換）
        const baseTitle = document.title.replace(/^\[[^\]]+\]\s*/,'');
        document.title = `[${label}]` + baseTitle;

        // バッジを body に追加
        const addBadge = () => {
          const el = document.createElement('div');
          el.className = `env-badge env-${label.toLowerCase()}`;
          el.textContent = label;
          document.body.appendChild(el);
          requestAnimationFrame(() => el.classList.add('show'));
        };
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', addBadge);
        } else {
          addBadge();
        }
      })();
    </script>

  </head>
  <body>
    <!-- スピナー -->
    <div id="splash">
      <img class="logo" src="/img/logo.webp" alt="MONOLISK-icon">
      <img class="name" src="/img/app-name.webp" alt="MONOLISK-name">
    </div>
    <div id="app" class="app-hidden"></div>
    <script type="module" src="/src/main.js"></script>
  </body>
</html>
